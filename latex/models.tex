\documentclass[a4paper,14pt,english]{extreport}

\usepackage{extsizes}
\usepackage{cmap}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{makecell}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{commath}
\usepackage{longtable}
\usepackage{datetime2}

\usepackage[usenames, dvipsnames]{color}
\definecolor{fontColor}{RGB}{169, 183, 198}
\definecolor{pageColor}{RGB}{43, 43, 43}

\makeatletter
\let\mytagform@=\tagform@
\def\tagform@#1{\maketag@@@{\color{fontColor}(#1)}}
\makeatother



\newcommand\fracn[2]{\mathchoice
	{{\textstyle\frac{\,\scriptstyle#1}{\!\!\scriptstyle#2}}}
	{\frac{\,#1}{\!\!#2}}
	{\frac{\,#1}{\!\!#2}}
	{\frac{\,#1}{\!\!#2}}
}

\newcommand\fraceq[2]{\mathchoice
	{{\displaystyle\frac{\,\textstyle#1}{\!\!\textstyle#2}}}
	{\frac{\,#1}{\!\!#2}}
	{\frac{\,#1}{\!\!#2}}
	{\frac{\,#1}{\!\!#2}}
}

\usepackage[width=1\textwidth, font={color=fontColor}]{caption}

\renewcommand\theequation{{\color{fontColor}\arabic{equation}}}
\renewcommand\thetable{{\color{fontColor}\arabic{table}}}
\renewcommand{\thepage}{{\color{fontColor}\arabic{page}}}


\usepackage[pdftex,unicode,colorlinks = true,linkcolor = fontColor]{hyperref}

\renewcommand{\thesection}{\arabic{section}}

\author{Aleksandr Zhuravlyov \and Zakhar Lanetc}

\title{CFD Boltzmann Method\\Theory}

\date{\DTMnow}

\begin{document}

    \pagecolor{pageColor}
     \color{fontColor}
    %\maketitle
    %\newpage
    %\tableofcontents{\thispagestyle{empty}}
    %\newpage

    \section*{FVM Diffusion transient flow}
    \subsection*{Generalised model}
    
The employed model of diffusion is derived by substituting the first Fick's law into the continuity equation. In integral form, this model can be represented as follows:

    \begin{eqnarray}
        \label{eq:general_diffusivity_integral}
        \int \limits_{V} a \frac{\partial C}{\partial t} d V - \oint \limits_{S} b \vec{\nabla}C \; \vec{dS} = \int \limits_{V} JdV,
    \end{eqnarray}
    where $C = C\left(\vec{x}, t\right)$~--~concentration, $\vec{x}$ ~--~radius vectors, $a = a\left(C\right)$ and can be treated as porosity, $t$~--~time, $V$~--~volume, $b = b\left(C\right)$ and can be treated as a product of porosity and diffusivity, $S$~--~surface area, $J=J\left(C\right)$~--~source term.
    
Equation (\ref{eq:general_diffusivity_integral}) describes the diffusive flow in general. The relevant boundary and initial conditions should be chosen in order to specialize this equation for the research purposes. Thus, the following boundary conditions have been applied:
    
    \begin{eqnarray}
        \label{eq:general_diffusivity_init}
        C\left(\vec{x}, \mathit{0}\right) = \hat{C}\left(\vec{x}\right), \; 
     \end{eqnarray}
    \begin{eqnarray}
      \label{eq:general_diffusivity_bound}
       C\left(\vec{x}, t\right)\Big|_{\mathit{\Gamma}_D} \!\!= \tilde{C}\left(\vec{x}, t\right), \; b \vec{\nabla}C \left(\vec{x}, t\right)\Big|_{\mathit{\Gamma}_N} \!\!= \vec{G}\left(\vec{x}, t\right),
    \end{eqnarray}
where $\mathit{\Gamma} = \mathit{\Gamma_D} + \mathit{\Gamma_N}$ is the boundary region.

The finite-volume representation of Eqs. (\ref{eq:general_diffusivity_integral}), (\ref{eq:general_diffusivity_init}), and (\ref{eq:general_diffusivity_bound}) can be described as follows:
    \begin{eqnarray}
        \label{eq:general_diffusivity_num}
        \alpha^n \Delta_{t} - \sum_{\Delta S} \beta^n\Delta_{x} = \gamma^n,
    \end{eqnarray}
    \begin{eqnarray}
         \label{eq:general_diffusivity_num_init}
        C = \hat{C}, \; 
    \end{eqnarray}
    \begin{eqnarray}
    \label{eq:general_diffusivity_num_bound}
    C \Big|_{\mathit{\Gamma}_D}= \tilde{C}, \; \beta^n\Delta_x \Big|_{\mathit{\Gamma}_N} = G\Delta S,
    \end{eqnarray}

Parameters $\alpha$ and $\beta$ are expressed as follows:
    \begin{eqnarray}
        \label{eq:general_alpha_beta_gamma}
        \alpha^n = a^n\frac{\Delta V}{\Delta t}, \;
        \beta^n = \overline{b}^n\frac{\Delta S}{\Delta L}, \; \gamma^n = J^n \Delta V,
    \end{eqnarray}
where $\Delta V$~--~volume of a particular grid-block, $\Delta t$~--~numerical time step, $a^n = a\left(C^n\right)$, $b^n = b\left(C^n\right)$, $\overline{b}$~--~average $b$, $J^n=J\left(C^n\right)$, $\Delta L$~--~distance between centres of two neighbouring grid-blocks whit respect to a particular surface, $\Delta S$~--~surface bounding a grid-block (positive or negative sign is defined by the normal direction).

The parameters $\Delta^{t}$ and $\Delta^{m}$ described by Eq. (\ref{eq:general_diffusivity_num}) are expressed as follows:
    \begin{eqnarray}
    \label{eq:general_delta_num}
    \Delta_t = C^{n+\mathit{1}} - C^{n}, \Delta_x = \begin{cases}
    C_{+}^{n+\mathit{1}} - C_{-}^{n+\mathit{1}} : &\text{implicit},\\
        C_{+}^{n} - C_{-}^{n} : &\text{explicit},
    \end{cases}
    \end{eqnarray}
where subscript signs $+$ and $-$ indicate the position of the finite-volume block relative to the normal direction of the current surface element $\Delta S$.

 \subsection*{Single-phase two-component (Langmuir only)}
Gas-coalbed system consists of the following mass balances for any component in the micro- and macropores:

\begin{eqnarray}
\begin{gathered}
\label{eq:langm_only_free_diffusivity_differential}
\frac{\partial C_{fi}}{\partial t} - \vec{\nabla} D_{fi} \vec{\nabla}C_{fi} = J,
\end{gathered}
\end{eqnarray}

\begin{eqnarray}
\begin{gathered}
\label{eq:langm_only_adsorbed_diffusivity_differential}
\frac{\partial C_{fi}}{\partial t} - \vec{\nabla} D_{fi} \vec{\nabla}C_{fi} = - \frac{\mathit{1} - \phi}{\phi} \frac{\partial C_{si}}{\partial t},
\end{gathered}
\end{eqnarray}
where $i$ - index of  a particular component, $C_{fi}$~--~total free gas concentration, $C_{si}$~--~adsorbed concentration, $D_{fi}$~--~effective molecular pore diffusion coefficient.

Knowing that
\begin{eqnarray}
\label{eq:langm_only_chain_rule_timeder}
\frac{\partial C_{si}}{\partial t} =  \frac{dC_{si}}{dC_{fi}}\frac{\partial C_{fi}}{\partial t} = C'_{si}\frac{\partial C_{fi}}{\partial t},
\end{eqnarray}

\begin{eqnarray}
\label{eq:langm_only_adsorbed_conc}
C_{si} =  \frac{C_{s} b_{i}' C_{fi}}{\mathit{1}+b_{i}'C_{fi}+b_{j}'C_{fj}},
\end{eqnarray}

\begin{eqnarray}
\label{eq:langm_only_adsorbed_conc_deriv}
C_{si}' =  \frac{C_{s}b_{i}' \left(\mathit{1}+b_{j}'\rho_{j}\right)}{\left(\mathit{1}+b_{i}'C_{fi}+b_{j}'C_{fj}\right)^\mathit{2}},
\end{eqnarray}
and by applying the divergence theorem, the following equation can be obtained
\begin{eqnarray}
\label{eq:langm_only_diffusivity_simplified_integral}
\int \limits_{V} a_{i} \frac{\partial C_{fi}}{\partial t} dV - \oint \limits_{S} b_{i} \vec{\nabla}C_{fi} \; \vec{dS} = \mathit{0},
\end{eqnarray}

where
\begin{eqnarray}
\begin{gathered}
\label{eq:langm_only_diffusivity_a_b_coeffs}
a_{i}  =  \mathit{1}+\frac{\mathit{1} - \phi}{\phi}C_{si}', \: b_{i}  = D_{i},
\end{gathered}
\end{eqnarray}
The following constraints must be satisfied during the simulation
\begin{eqnarray}
\label{eq:langm_only_concentration_constaints}
a_{i}, b_{i} \mid \mathit{0} \leq C_{fi} \leq \rho_i,
\end{eqnarray}

\begin{eqnarray}
\label{eq:langm_only_diffusivity_densities}
C_{fj} =\rho_j -  \frac{\rho_j}{\rho_i}C_{fi},
\end{eqnarray} 

The flow rate can be calculated as follows
\begin{eqnarray}
\label{eq:langm_only_flow_rate_i}
G_{fi} = - D_{fi}S \:\nabla C_{fi},
\end{eqnarray} 

\begin{eqnarray}
\label{eq:langm_only_flow_rate_j}
G_{fj} = -  \frac{\rho_j}{\rho_i}G_{fi}.
\end{eqnarray} 

\subsection*{Two-phase two-component (Langmuir \& Fick)}
Gas-coalbed system consists of the following mass balances for one of the components in the micro- and macropores:
\begin{eqnarray}
\begin{gathered}
\label{eq:multiphase_free_diffusivity_differential}
\phi \frac{\partial C_{fi}}{\partial t}  - \vec{\nabla} \phi D_{fi} \vec{\nabla}C_{fi} = J_i,
\end{gathered}
\end{eqnarray}

\begin{eqnarray}
\begin{gathered}
\label{eq:multiphase_adsorbed_diffusivity_differential}
\left(\mathit{1}-\phi\right) \frac{\partial C_{si}}{\partial t}  - \vec{\nabla} \left(\mathit{1}-\phi\right) D_{si} \vec{\nabla}C_{si} = -J_i,
\end{gathered}
\end{eqnarray}

where $i$ - index of  a particular component, $C_{f}$~--~total free gas concentration, $\phi$~--~is total porosity (matrix and fractures), $C_{s}$~--~adsorbed concentration, $D_{f}$~--~effective molecular pore diffusion coefficient, $D_{s}$~--~surface molecular diffusion coefficient, $J=J\left(C_{fi}, C_{fj}, C_{si} \right)$~--~source term calculated using the Langmuir equation (\ref{eq:langm_only_adsorbed_conc}).

\begin{eqnarray}
\begin{gathered}
\label{eq:multiphase_free_diffusivity_integral}
\int \limits_{V} \phi \frac{\partial C_{fi}}{\partial t} dV  - \oint \limits_{S} \phi D_{fi} \vec{\nabla}C_{fi} \; \vec{dS} = \int \limits_{V} J_i \; dV,
\end{gathered}
\end{eqnarray}

\begin{eqnarray}
\begin{gathered}
\label{eq:multiphase_adsorbed_diffusivity_integral}
\int \limits_{V} \left(\mathit{1}-\phi\right) \frac{\partial C_{si}}{\partial t} dV - \oint \limits_{S} \left(\mathit{1}-\phi\right) D_{si} \vec{\nabla}C_{si} \; \vec{dS} = -\int \limits_{V}J_i \; dV,
\end{gathered}
\end{eqnarray}

both Eqs. (\ref{eq:multiphase_free_diffusivity_integral}) and (\ref{eq:multiphase_adsorbed_diffusivity_integral}) can be presented in the following forms:

\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\int \limits_{V} a_{f} \frac{\partial C_{fi}}{\partial t} dV - \oint \limits_{S} b_{fi} \vec{\nabla}C_{fi} \; \vec{dS} = \int \limits_{V} J_{i} \; dV,
\end{eqnarray}
\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\int \limits_{V} a_{s} \frac{\partial C_{si}}{\partial t} dV - \oint \limits_{S} b_{si} \vec{\nabla}C_{si} \; \vec{dS} = -\int \limits_{V} J_{i} \; dV,
\end{eqnarray}

\begin{eqnarray}
\label{eq:multiphase_diffusivity_densities}
b_{fi}, b_{fj}, J_{i}, J_{j} \mid \frac{C_{fi}}{\rho_i} + \frac{C_{fj}}{\rho_j} = \mathit{1},
\end{eqnarray}
where 

\begin{eqnarray}
\label{eq:multiphase_diffusivity_a_b_coeffs_free}
\begin{gathered}
a_{f} = \phi, \; b_{fi} = \phi D_{fi},
\end{gathered}
\end{eqnarray}
\begin{eqnarray}
\label{eq:multiphase_diffusivity_a_b_coeffs_adsorbed}
\begin{gathered}
a_{s} = \left(\mathit{1}-\phi\right), \; b_{si} = \left(\mathit{1}-\phi\right) D_{si}.
\end{gathered}
\end{eqnarray}

\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\int \limits_{V} a_{f} \frac{\partial C_{fj}}{\partial t} dV - \oint \limits_{S} b_{fj} \vec{\nabla}C_{fj} \; \vec{dS} = \int \limits_{V} J_{j} \; dV,
\end{eqnarray}
\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\int \limits_{V} a_{f} \frac{\partial C_{fj}}{\partial t} dV - \oint \limits_{S} b_{fi} \vec{\nabla}C_{fj} \; \vec{dS} = -\int \limits_{V} \frac{\rho_j}{\rho_i}J_{i} \; dV,
\end{eqnarray}

\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\oint \limits_{S} b_{fj} \vec{\nabla}C_{fj} \vec{dS}
+ \int \limits_{V} J_{j} \; dV
= \oint \limits_{S} b_{fi} \vec{\nabla}C_{fj} \vec{dS}
-\int \limits_{V} \frac{\rho_j}{\rho_i}J_{i} \; dV,
\end{eqnarray}

\begin{eqnarray}
\label{eq:multiphase_diffusivity_simplified_integral}
\oint \limits_{S} \left(b_{fj}-b_{fi}\right) \vec{\nabla}C_{fj} \vec{dS}
= -\int \limits_{V} \left(J_{j}+\frac{\rho_j}{\rho_i}J_{i}\right) \; dV.
\end{eqnarray}

\subsection*{Single-phase two-component (Langmuir \& Fick)}
Gas-coalbed system consists of the following mass balances for any component in the micro- and macropores:

\begin{eqnarray}
\begin{gathered}
\label{eq:langm_fick_diffusivity_differential}
\phi\frac{\partial C_{fi}}{\partial t} + \left(\mathit{1}-\phi\right)\frac{\partial C_{si}}{\partial t} - \vec{\nabla} \phi D_{fi} \vec{\nabla}C_{fi} - \vec{\nabla}\left(\mathit{1}-\phi \right) D_{si} \vec{\nabla}C_{si} =  \mathit{0},
\end{gathered}
\end{eqnarray}
where $i$ - index of  a particular component, $C_{fi}$~--~total free gas concentration, $\phi$~--~is total porosity, $C_{si}$~--~adsorbed concentration, $D_{fi}$~--~effective molecular pore diffusion coefficient, $D_{si}$~--~surface molecular diffusion coefficient.

Using Eqs. (\ref{eq:langm_only_chain_rule_timeder}), (\ref{eq:langm_only_adsorbed_conc}) and (\ref{eq:langm_only_adsorbed_conc_deriv}) and by knowing that

\begin{eqnarray}
\label{eq:langm_fick_chain_rule_spaceder}
\vec\nabla C_{si} =  \frac{dC_{si}}{dC_{fi}}\vec\nabla C_{fi} = C'_{si}\vec\nabla C_{fi},
\end{eqnarray}
we can apply the divergence theorem and obtain the following equation:
\begin{eqnarray}
\label{eq:langm_fick_diffusivity_simplified_integral}
\int \limits_{V} a_{i} \frac{\partial C_{fi}}{\partial t} d V - \oint \limits_{S} b_{i} \vec{\nabla}C_{fi} \; \vec{dS} =  \mathit{0},
\end{eqnarray}
where  
\begin{eqnarray}
\begin{gathered}
\label{eq:langm_fick_diffusivity_a_b_coeffs}
a_{i}  =  \phi + \left(\mathit{1}-\phi \right)C_{si}', \\ 
b_{i}  = \phi D_{fi} + \left(\mathit{1}-\phi \right) C_{si}'D_{si},
\end{gathered}
\end{eqnarray}

The following constraints must be satisfied during the simulation

\begin{eqnarray}
\label{eq:angm_fick_concentration_constaints}
a_{i}, b_{i} \mid  \mathit{0} \leq C_{fi} \leq \rho_i,
\end{eqnarray}

\begin{eqnarray}
\label{eq:langm_fick_diffusivity_densities}
C_{fj} =\rho_j -  \frac{\rho_j}{\rho_i}C_{fi}.
\end{eqnarray} 
 
\end{document}
